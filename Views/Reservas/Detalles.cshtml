@model AgenciaDeTransporteWeb.Models.Entities.Reserva
@{
    ViewData["Title"] = "Detalles de Reserva";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-ticket-alt me-2"></i>
                            Detalles de Reserva
                        </h4>
                        <span class="badge @GetEstadoBadgeClass(Model.EstadoReserva) fs-6">
                            @Model.EstadoReserva
                        </span>
                    </div>
                </div>

                <div class="card-body p-4">
                    <!-- Código de reserva destacado -->
                    <div class="text-center mb-4 p-3 bg-light rounded">
                        <h3 class="text-primary mb-1">@Model.CodigoReserva</h3>
                        <p class="text-muted mb-0">Código de Reserva</p>
                    </div>

                    <!-- Información del viaje -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="info-section">
                                <h6 class="section-title">
                                    <i class="fas fa-route text-primary me-2"></i>
                                    Información del Viaje
                                </h6>
                                <div class="info-content">
                                    <div class="route-display">
                                        <div class="city-info">
                                            <span class="city-name">@Model.Viaje.Ruta.CiudadOrigen</span>
                                        </div>
                                        <div class="route-arrow">
                                            <i class="fas fa-arrow-right"></i>
                                        </div>
                                        <div class="city-info">
                                            <span class="city-name">@Model.Viaje.Ruta.CiudadDestino</span>
                                        </div>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">
                                            <i class="fas fa-calendar me-2"></i>Fecha de Salida:
                                        </span>
                                        <span class="detail-value">@Model.Viaje.FechaSalida.ToString("dddd, dd 'de' MMMM 'de' yyyy")</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">
                                            <i class="fas fa-clock me-2"></i>Hora de Salida:
                                        </span>
                                        <span class="detail-value">@Model.Viaje.FechaSalida.ToString("HH:mm")</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">
                                            <i class="fas fa-clock me-2"></i>Hora de Llegada:
                                        </span>
                                        <span class="detail-value">@Model.Viaje.FechaLlegada.ToString("HH:mm")</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-section">
                                <h6 class="section-title">
                                    <i class="fas fa-bus text-primary me-2"></i>
                                    Información del Autobús
                                </h6>
                                <div class="info-content">
                                    <div class="detail-row">
                                        <span class="detail-label">
                                            <i class="fas fa-id-card me-2"></i>Placa:
                                        </span>
                                        <span class="detail-value">@Model.Viaje.Autobus.Placa</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">
                                            <i class="fas fa-bus me-2"></i>Modelo:
                                        </span>
                                        <span class="detail-value">@Model.Viaje.Autobus.Marca @Model.Viaje.Autobus.Modelo</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">
                                            <i class="fas fa-chair me-2"></i>Asiento:
                                        </span>
                                        <span class="detail-value">
                                            Nº @Model.Asiento.NumeroAsiento
                                            <span class="badge bg-info ms-2">@Model.Asiento.TipoAsiento</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Información del pasajero -->
                    <div class="info-section mb-4">
                        <h6 class="section-title">
                            <i class="fas fa-user text-primary me-2"></i>
                            Información del Pasajero
                        </h6>
                        <div class="info-content">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="detail-row">
                                        <span class="detail-label">
                                            <i class="fas fa-user me-2"></i>Nombre:
                                        </span>
                                        <span class="detail-value">@Model.Usuario.NombreCompleto</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="detail-row">
                                        <span class="detail-label">
                                            <i class="fas fa-envelope me-2"></i>Email:
                                        </span>
                                        <span class="detail-value">@Model.Usuario.Email</span>
                                    </div>
                                </div>
                                @if (!string.IsNullOrEmpty(Model.Usuario.Documento))
                                {
                                    <div class="col-md-6">
                                        <div class="detail-row">
                                            <span class="detail-label">
                                                <i class="fas fa-id-card me-2"></i>Documento:
                                            </span>
                                            <span class="detail-value">@Model.Usuario.Documento</span>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Información de pago -->
                    <div class="info-section mb-4">
                        <h6 class="section-title">
                            <i class="fas fa-money-bill-wave text-primary me-2"></i>
                            Información de Pago
                        </h6>
                        <div class="info-content">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="detail-row">
                                        <span class="detail-label">Fecha de Reserva:</span>
                                        <span class="detail-value">@Model.FechaReserva.ToString("dd/MM/yyyy HH:mm")</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="detail-row">
                                        <span class="detail-label">Monto Total:</span>
                                        <span class="detail-value text-success fw-bold fs-5">S/. @Model.MontoTotal</span>
                                    </div>
                                </div>
                            </div>

                            @if (TempData["ReferenciaPago"] != null)
                            {
                                <div class="alert alert-success mt-3">
                                    <i class="fas fa-check-circle me-2"></i>
                                    <strong>Pago Procesado:</strong> Referencia @TempData["ReferenciaPago"]
                                </div>
                            }
                        </div>
                    </div>

                    <!-- Acciones -->
                    <div class="action-buttons">
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <a asp-action="Index" class="btn btn-outline-primary w-100">
                                    <i class="fas fa-list me-2"></i>
                                    Ver Todas mis Reservas
                                </a>
                            </div>

                            @if (Model.EstadoReserva == "Pendiente")
                            {
                                <div class="col-md-6 mb-2">
                                    <a asp-action="Pagar" asp-route-id="@Model.Id" class="btn btn-success w-100">
                                        <i class="fas fa-credit-card me-2"></i>
                                        Procesar Pago
                                    </a>
                                </div>
                            }

                            @if (Model.EstadoReserva == "Confirmada" || Model.EstadoReserva == "Completada")
                            {
                                <div class="col-md-6 mb-2">
                                    <a asp-action="DescargarTicket" asp-route-codigo="@Model.CodigoReserva"
                                       class="btn btn-info w-100" target="_blank">
                                        <i class="fas fa-download me-2"></i>
                                        Descargar Ticket
                                    </a>
                                </div>
                            }

                            @if (Model.EstadoReserva == "Pendiente" && Model.Viaje.FechaSalida > DateTime.Now.AddHours(2))
                            {
                                <div class="col-md-12 mt-2">
                                    <form asp-action="Cancelar" asp-route-id="@Model.Id" method="post"
                                          onsubmit="return confirm('¿Está seguro de cancelar esta reserva?')" class="d-inline w-100">
                                        <button type="submit" class="btn btn-outline-danger w-100">
                                            <i class="fas fa-times me-2"></i>
                                            Cancelar Reserva
                                        </button>
                                    </form>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Información adicional -->
            <div class="card mt-4">
                <div class="card-body">
                    <h6 class="text-primary mb-3">
                        <i class="fas fa-info-circle me-2"></i>
                        Información Importante
                    </h6>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled small text-muted">
                                <li><i class="fas fa-check text-success me-2"></i>Presentar documento de identidad al abordar</li>
                                <li><i class="fas fa-check text-success me-2"></i>Llegar 15 minutos antes de la salida</li>
                                <li><i class="fas fa-check text-success me-2"></i>Este ticket es personal e intransferible</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled small text-muted">
                                <li><i class="fas fa-phone text-info me-2"></i>Soporte: +51 999 888 777</li>
                                <li><i class="fas fa-envelope text-info me-2"></i>Email: soporte@transportemax.com</li>
                                <li><i class="fas fa-clock text-warning me-2"></i>Cancelaciones hasta 2 horas antes</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



@functions {
    private string GetEstadoBadgeClass(string estado)
    {
        return estado switch
        {
            "Pendiente" => "bg-warning text-dark",
            "Confirmada" => "bg-success",
            "Cancelada" => "bg-danger",
            "Completada" => "bg-info",
            _ => "bg-secondary"
        };
    }
}